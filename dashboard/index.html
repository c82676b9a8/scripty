<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scripty RAT</title>
    <link rel="icon" type="image/png" href="assets/logo/logo_2.png">
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .card { background: #1e293b; padding: 40px; border-radius: 16px; border: 1px solid #3b82f6; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        h1 { margin-top: 0; color: #3b82f6; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        button:hover { filter: brightness(1.1); }
        .btn-sec { background: #475569; }
        #publicMessage { display: none; }
        #repeatPassField { display: none; } /* Hidden by default */
    </style>
</head>
<body>

    <!-- LOGIN FORM -->
    <div id="loginForm" class="card">
        <h1 id="formTitle">ðŸ”’ Secure Login</h1>
        
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        
        <!-- REPEAT PASSWORD (Hidden initially) -->
        <input type="password" id="repeatPassword" placeholder="Repeat Password" style="display:none;">

        <button id="mainBtn" onclick="handleMainBtn()">Login</button>
        <button class="btn-sec" onclick="toggleMode()">Switch to Register</button>
        
        <p id="errorMsg" style="color: #ef4444; margin-top: 10px; font-size: 0.9rem;"></p>
    </div>

    <!-- PUBLIC PAGE -->
    <div id="publicMessage" class="card" style="border-color: #22c55e;">
        <h1>ðŸš€ Scripty RAT</h1>
        <p>Welcome! We are currently preparing our exclusive product line.</p>
        <button class="btn-sec" onclick="logout()">Log Out</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhG3jjUoP6F-MHIqYKP7TvCh4FQ_Rfcd0",
            authDomain: "potkan-5132c.firebaseapp.com",
            projectId: "potkan-5132c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const ADMIN_UID = "sJSL8EjvFhMpoiD4yaAThWDKsf32"; 

        // STATE
        let isRegisterMode = false;

        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (user.uid === ADMIN_UID) window.location.href = "panel.html";
                else {
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('publicMessage').style.display = 'block';
                }
            } else {
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('publicMessage').style.display = 'none';
            }
        });

        window.toggleMode = () => {
            isRegisterMode = !isRegisterMode;
            const title = document.getElementById('formTitle');
            const mainBtn = document.getElementById('mainBtn');
            const repeatField = document.getElementById('repeatPassword');
            const switchBtn = document.querySelector('.btn-sec');

            if (isRegisterMode) {
                title.innerText = "ðŸ“ Register Account";
                mainBtn.innerText = "Register";
                switchBtn.innerText = "Back to Login";
                repeatField.style.display = "block";
            } else {
                title.innerText = "ðŸ”’ Secure Login";
                mainBtn.innerText = "Login";
                switchBtn.innerText = "Switch to Register";
                repeatField.style.display = "none";
            }
        };

        window.handleMainBtn = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            const p2 = document.getElementById('repeatPassword').value;
            const err = document.getElementById('errorMsg');

            if (isRegisterMode) {
                // REGISTER LOGIC
                if (p !== p2) {
                    err.innerText = "Passwords do not match!";
                    return;
                }
                createUserWithEmailAndPassword(auth, e, p)
                    .then(cred => alert("Registered! UID: " + cred.user.uid))
                    .catch(e => err.innerText = e.message);
            } else {
                // LOGIN LOGIC
                signInWithEmailAndPassword(auth, e, p)
                    .catch(e => err.innerText = e.message);
            }
        };

        window.logout = () => signOut(auth);
    </script>
</body>
</html>
